# Usage Types Specification

This document defines the stable `usage` object structure returned by all AI endpoints.

## Usage Object Structure

The `usage` object is based on the SDK's `NonNullableUsage` type, which guarantees all fields are present (nulls are converted to 0).

```typescript
interface Usage {
  input_tokens: number; // Tokens in the input prompt
  output_tokens: number; // Tokens in the generated response
  cache_creation_input_tokens: number; // Tokens used to create cache entries
  cache_read_input_tokens: number; // Tokens read from cache (reduced cost)
}
```

## Field Definitions

- **input_tokens**: Total number of tokens in the input prompt sent to the model
- **output_tokens**: Total number of tokens generated by the model in the response
- **cache_creation_input_tokens**: Tokens consumed when creating new cache entries (first time seeing context)
- **cache_read_input_tokens**: Tokens read from existing cache (significantly reduced cost compared to input_tokens)

## API Consistency

All endpoints that return usage information MUST include all four fields, even if the values are 0. This ensures:

1. **API Stability**: Clients can always expect these fields to be present
2. **Type Safety**: TypeScript clients can use non-nullable types
3. **Cost Tracking**: Complete token usage for accurate cost calculation

## Example Responses

### Initial Request (No Cache)

```json
{
  "usage": {
    "input_tokens": 1500,
    "output_tokens": 800,
    "cache_creation_input_tokens": 1000, // Creating cache
    "cache_read_input_tokens": 0 // No cache to read
  }
}
```

### Subsequent Request (Using Cache)

```json
{
  "usage": {
    "input_tokens": 500,
    "output_tokens": 600,
    "cache_creation_input_tokens": 0, // Not creating new cache
    "cache_read_input_tokens": 1000 // Reading from cache
  }
}
```

## Cost Calculation

For accurate cost tracking:

```typescript
const calculateCost = (usage: Usage): number => {
  const rates = {
    input: 0.003, // per 1K tokens
    output: 0.015, // per 1K tokens
    cache_creation: 0.00375, // per 1K tokens (125% of input)
    cache_read: 0.0003, // per 1K tokens (10% of input)
  };

  return (
    (usage.input_tokens * rates.input) / 1000 +
    (usage.output_tokens * rates.output) / 1000 +
    (usage.cache_creation_input_tokens * rates.cache_creation) / 1000 +
    (usage.cache_read_input_tokens * rates.cache_read) / 1000
  );
};
```

## Implementation Notes

1. When SDK returns nullable fields, convert to 0 before returning to clients
2. Always include all four fields in responses, even for non-cached operations
3. Document usage in API responses for transparency
4. Consider adding `total_cost_usd` field calculated server-side using current rates
